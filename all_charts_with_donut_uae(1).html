<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>D3.js Charts</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .chart-container { margin-bottom: 40px; }
    svg { border: 1px solid #ccc; }
    .tooltip { position: absolute; background: #333; color: #fff; padding: 5px 10px; border-radius: 3px; font-size: 12px; }
    .bar, .column, .arc, .stacked-bar { transition: opacity 0.2s; }
    .bar:hover, .column:hover, .arc:hover, .stacked-bar:hover { opacity: 0.7; }
  </style>
</head>
<body>
  <div class="chart-container">
    <h2>Bar Chart: Sales by Category</h2>
    <div id="bar-chart"></div>
  </div>

  <div class="chart-container">
    <h2>Column Chart: Revenue by Region</h2>
    <div id="column-chart"></div>
  </div>

  <div class="chart-container">
    <h2>Pie Chart: Market Share</h2>
    <div id="pie-chart"></div>
  </div>

  <div class="chart-container">
    <h2>Donut Chart: Product Distribution</h2>
    <div id="donut-chart"></div>
  </div>

  <div class="chart-container">
    <h2>Geo Chart: UAE Regions</h2>
    <div id="geo-chart"></div>
  </div>

  <div class="chart-container">
    <h2>Stacked Column Chart: Fruit Sales by Month</h2>
    <div id="stacked-column-chart"></div>
  </div>

  <div class="chart-container">
    <h2>Series Column Chart: Metrics by Month</h2>
    <div id="series-column-chart"></div>
  </div>

  <script>
    // Tooltip
    const tooltip = d3.select("body")
      .append("div")
      .attr("class", "tooltip")
      .style("opacity", 0);

    // Bar Chart: Sales by Category
    const barData = [
      { category: "Electronics", sales: 300 },
      { category: "Clothing", sales: 180 },
      { category: "Books", sales: 100 },
      { category: "Toys", sales: 240 }
    ];
    const barSvg = d3.select("#bar-chart")
      .append("svg")
      .attr("width", 400)
      .attr("height", 300);
    const barMargin = { top: 20, right: 20, bottom: 40, left: 40 };
    const barWidth = 400 - barMargin.left - barMargin.right;
    const barHeight = 300 - barMargin.top - barMargin.bottom;
    const barX = d3.scaleBand()
      .domain(barData.map(d => d.category))
      .range([0, barWidth])
      .padding(0.1);
    const barY = d3.scaleLinear()
      .domain([0, d3.max(barData, d => d.sales)])
      .range([barHeight, 0]);
    const barG = barSvg.append("g")
      .attr("transform", `translate(${barMargin.left},${barMargin.top})`);
    barG.selectAll(".bar")
      .data(barData)
      .enter()
      .append("rect")
      .attr("class", "bar")
      .attr("x", d => barX(d.category))
      .attr("y", d => barY(d.sales))
      .attr("width", barX.bandwidth())
      .attr("height", d => barHeight - barY(d.sales))
      .attr("fill", "#1f77b4")
      .on("mouseover", function(event, d) {
        tooltip.transition().duration(200).style("opacity", 0.9);
        tooltip.html(`${d.category}: ${d.sales}`)
          .style("left", (event.pageX + 10) + "px")
          .style("top", (event.pageY - 28) + "px");
      })
      .on("mouseout", function() {
        tooltip.transition().duration(500).style("opacity", 0);
      });
    barG.append("g")
      .attr("transform", `translate(0,${barHeight})`)
      .call(d3.axisBottom(barX));
    barG.append("g")
      .call(d3.axisLeft(barY));

    // Column Chart: Revenue by Region
    const columnData = [
      { region: "North", revenue: 500 },
      { region: "South", revenue: 400 },
      { region: "East", revenue: 300 },
      { region: "West", revenue: 200 }
    ];
    const columnSvg = d3.select("#column-chart")
      .append("svg")
      .attr("width", 400)
      .attr("height", 300);
    const columnMargin = { top: 20, right: 20, bottom: 40, left: 40 };
    const columnWidth = 400 - columnMargin.left - columnMargin.right;
    const columnHeight = 300 - columnMargin.top - columnMargin.bottom;
    const columnX = d3.scaleBand()
      .domain(columnData.map(d => d.region))
      .range([0, columnWidth])
      .padding(0.1);
    const columnY = d3.scaleLinear()
      .domain([0, d3.max(columnData, d => d.revenue)])
      .range([columnHeight, 0]);
    const columnG = columnSvg.append("g")
      .attr("transform", `translate(${columnMargin.left},${columnMargin.top})`);
    columnG.selectAll(".column")
      .data(columnData)
      .enter()
      .append("rect")
      .attr("class", "column")
      .attr("x", d => columnX(d.region))
      .attr("y", d => columnY(d.revenue))
      .attr("width", columnX.bandwidth())
      .attr("height", d => columnHeight - columnY(d.revenue))
      .attr("fill", "#ff7f0e")
      .on("mouseover", function(event, d) {
        tooltip.transition().duration(200).style("opacity", 0.9);
        tooltip.html(`${d.region}: ${d.revenue}`)
          .style("left", (event.pageX + 10) + "px")
          .style("top", (event.pageY - 28) + "px");
      })
      .on("mouseout", function() {
        tooltip.transition().duration(500).style("opacity", 0);
      });
    columnG.append("g")
      .attr("transform", `translate(0,${columnHeight})`)
      .call(d3.axisBottom(columnX));
    columnG.append("g")
      .call(d3.axisLeft(columnY));

    // Pie Chart: Market Share
    const pieData = [
      { name: "Brand A", value: 40 },
      { name: "Brand B", value: 30 },
      { name: "Brand C", value: 20 },
      { name: "Brand D", value: 10 }
    ];
    const pieSvg = d3.select("#pie-chart")
      .append("svg")
      .attr("width", 400)
      .attr("height", 300);
    const pieRadius = Math.min(400, 300) / 2 - 40;
    const pie = d3.pie()
      .value(d => d.value);
    const arc = d3.arc()
      .innerRadius(0)
      .outerRadius(pieRadius);
    const pieG = pieSvg.append("g")
      .attr("transform", `translate(200,150)`);
    const color = d3.scaleOrdinal()
      .domain(pieData.map(d => d.name))
      .range(["#1f77b4", "#ff7f0e", "#2ca02c", "#d62728"]);
    pieG.selectAll(".arc")
      .data(pie(pieData))
      .enter()
      .append("path")
      .attr("class", "arc")
      .attr("d", arc)
      .attr("fill", d => color(d.data.name))
      .on("mouseover", function(event, d) {
        tooltip.transition().duration(200).style("opacity", 0.9);
        tooltip.html(`${d.data.name}: ${d.data.value}%`)
          .style("left", (event.pageX + 10) + "px")
          .style("top", (event.pageY - 28) + "px");
      })
      .on("mouseout", function() {
        tooltip.transition().duration(500).style("opacity", 0);
      });

    // Donut Chart: Product Distribution
    const donutData = [
      { product: "Product A", value: 50 },
      { product: "Product B", value: 30 },
      { product: "Product C", value: 15 },
      { product: "Product D", value: 5 }
    ];
    const donutSvg = d3.select("#donut-chart")
      .append("svg")
      .attr("width", 400)
      .attr("height", 300);
    const donutArc = d3.arc()
      .innerRadius(pieRadius * 0.5)
      .outerRadius(pieRadius);
    const donutG = donutSvg.append("g")
      .attr("transform", `translate(200,150)`);
    donutG.selectAll(".arc")
      .data(pie(donutData))
      .enter()
      .append("path")
      .attr("class", "arc")
      .attr("d", donutArc)
      .attr("fill", d => color(d.data.product))
      .on("mouseover", function(event, d) {
        tooltip.transition().duration(200).style("opacity", 0.9);
        tooltip.html(`${d.data.product}: ${d.data.value}%`)
          .style("left", (event.pageX + 10) + "px")
          .style("top", (event.pageY - 28) + "px");
      })
      .on("mouseout", function() {
        tooltip.transition().duration(500).style("opacity", 0);
      });

    // Geo Chart: UAE Regions (unchanged)
    const uaeRegions = [
      { name: 'Dubai', lat: 25.2048, lng: 55.2708 },
      { name: 'Al Ain', lat: 24.2075, lng: 55.7461 },
      { name: 'Ras Al-Khaimah', lat: 25.7895, lng: 55.9432 },
      { name: 'West Coast', lat: 24.3713, lng: 54.4485 },
      { name: 'East Coast', lat: 25.3302, lng: 56.3439 },
      { name: 'Western Region', lat: 23.4241, lng: 53.8478 },
    ];
    const geoSvg = d3.select("#geo-chart")
      .append("svg")
      .attr("width", 800)
      .attr("height", 500);
    const projection = d3.geoMercator()
      .scale(4000)
      .center([54.5, 24.5])
      .translate([400, 250]);
    const path = d3.geoPath().projection(projection);
    d3.json("https://raw.githubusercontent.com/izuku-mi/geochart/9c1b9686b83ef558281c25dd917b20acd27f11d0/ae.json")
      .then(function(geojson) {
        geoSvg.selectAll("path")
          .data(geojson.features)
          .enter()
          .append("path")
          .attr("d", path)
          .attr("fill", "#69b3a2")
          .attr("stroke", "#fff")
          .attr("stroke-width", 1)
          .on("mouseover", function(event, d) {
            d3.select(this).attr("fill", "#ff9999");
            tooltip.transition().duration(200).style("opacity", 0.9);
            tooltip.html(d.properties.name)
              .style("left", (event.pageX + 10) + "px")
              .style("top", (event.pageY - 28) + "px");
          })
          .on("mouseout", function() {
            d3.select(this).attr("fill", "#69b3a2");
            tooltip.transition().duration(500).style("opacity", 0);
          });
        geoSvg.selectAll("circle")
          .data(uaeRegions)
          .enter()
          .append("circle")
          .attr("cx", d => projection([d.lng, d.lat])[0])
          .attr("cy", d => projection([d.lng, d.lat])[1])
          .attr("r", 5)
          .attr("fill", "red")
          .attr("stroke", "#fff")
          .attr("stroke-width", 1)
          .on("mouseover", function(event, d) {
            tooltip.transition().duration(200).style("opacity", 0.9);
            tooltip.html(d.name)
              .style("left", (event.pageX + 10) + "px")
              .style("top", (event.pageY - 28) + "px");
          })
          .on("mouseout", function() {
            tooltip.transition().duration(500).style("opacity", 0);
          });
      })
      .catch(function(error) {
        console.error("Error loading GeoJSON:", error);
      });

    // Stacked Column Chart: Fruit Sales by Month
    const stackedData = [
      { month: "Jan", apples: 30, oranges: 20, bananas: 10 },
      { month: "Feb", apples: 20, oranges: 30, bananas: 15 },
      { month: "Mar", apples: 25, oranges: 25, bananas: 20 },
      { month: "Apr", apples: 15, oranges: 35, bananas: 25 }
    ];
    const stack = d3.stack()
      .keys(["apples", "oranges", "bananas"]);
    const stackedSeries = stack(stackedData);
    const stackedSvg = d3.select("#stacked-column-chart")
      .append("svg")
      .attr("width", 400)
      .attr("height", 300);
    const stackedMargin = { top: 20, right: 20, bottom: 40, left: 40 };
    const stackedWidth = 400 - stackedMargin.left - stackedMargin.right;
    const stackedHeight = 300 - stackedMargin.top - stackedMargin.bottom;
    const stackedX = d3.scaleBand()
      .domain(stackedData.map(d => d.month))
      .range([0, stackedWidth])
      .padding(0.1);
    const stackedY = d3.scaleLinear()
      .domain([0, d3.max(stackedSeries, d => d3.max(d, d => d[1]))])
      .range([stackedHeight, 0]);
    const stackedG = stackedSvg.append("g")
      .attr("transform", `translate(${stackedMargin.left},${stackedMargin.top})`);
    const stackedColors = ["#1f77b4", "#ff7f0e", "#2ca02c"];
    stackedG.selectAll("g")
      .data(stackedSeries)
      .enter()
      .append("g")
      .attr("fill", (d, i) => stackedColors[i])
      .selectAll("rect")
      .data(d => d)
      .enter()
      .append("rect")
      .attr("class", "stacked-bar")
      .attr("x", d => stackedX(d.data.month))
      .attr("y", d => stackedY(d[1]))
      .attr("height", d => stackedY(d[0]) - stackedY(d[1]))
      .attr("width", stackedX.bandwidth())
      .on("mouseover", function(event, d) {
        const key = d3.select(this.parentNode).datum().key;
        tooltip.transition().duration(200).style("opacity", 0.9);
        tooltip.html(`${key}: ${d[1] - d[0]}`)
          .style("left", (event.pageX + 10) + "px")
          .style("top", (event.pageY - 28) + "px");
      })
      .on("mouseout", function() {
        tooltip.transition().duration(500).style("opacity", 0);
      });
    stackedG.append("g")
      .attr("transform", `translate(0,${stackedHeight})`)
      .call(d3.axisBottom(stackedX));
    stackedG.append("g")
      .call(d3.axisLeft(stackedY));

    // Series Column Chart: Metrics by Month
    const seriesData = [
      { month: "Jan", metric1: 100, metric2: 80, metric3: 60 },
      { month: "Feb", metric1: 120, metric2: 90, metric3: 70 },
      { month: "Mar", metric1: 110, metric2: 100, metric3: 80 },
      { month: "Apr", metric1: 130, metric2: 110, metric3: 90 }
    ];
    const seriesSvg = d3.select("#series-column-chart")
      .append("svg")
      .attr("width", 400)
      .attr("height", 300);
    const seriesMargin = { top: 20, right: 20, bottom: 40, left: 40 };
    const seriesWidth = 400 - seriesMargin.left - seriesMargin.right;
    const seriesHeight = 300 - seriesMargin.top - seriesMargin.bottom;
    const seriesX = d3.scaleBand()
      .domain(seriesData.map(d => d.month))
      .range([0, seriesWidth])
      .paddingInner(0.1);
    const seriesXSubgroup = d3.scaleBand()
      .domain(["metric1", "metric2", "metric3"])
      .range([0, seriesX.bandwidth()])
      .padding(0.05);
    const seriesY = d3.scaleLinear()
      .domain([0, d3.max(seriesData, d => d3.max([d.metric1, d.metric2, d.metric3]))])
      .range([seriesHeight, 0]);
    const seriesG = seriesSvg.append("g")
      .attr("transform", `translate(${seriesMargin.left},${seriesMargin.top})`);
    const seriesColors = ["#1f77b4", "#ff7f0e", "#2ca02c"];
    seriesG.selectAll("g")
      .data(seriesData)
      .enter()
      .append("g")
      .attr("transform", d => `translate(${seriesX(d.month)},0)`)
      .selectAll("rect")
      .data(d => [
        { key: "metric1", value: d.metric1 },
        { key: "metric2", value: d.metric2 },
        { key: "metric3", value: d.metric3 }
      ])
      .enter()
      .append("rect")
      .attr("class", "column")
      .attr("x", d => seriesXSubgroup(d.key))
      .attr("y", d => seriesY(d.value))
      .attr("width", seriesXSubgroup.bandwidth())
      .attr("height", d => seriesHeight - seriesY(d.value))
      .attr("fill", (d, i) => seriesColors[i])
      .on("mouseover", function(event, d) {
        tooltip.transition().duration(200).style("opacity", 0.9);
        tooltip.html(`${d.key}: ${d.value}`)
          .style("left", (event.pageX + 10) + "px")
          .style("top", (event.pageY - 28) + "px");
      })
      .on("mouseout", function() {
        tooltip.transition().duration(500).style("opacity", 0);
      });
    seriesG.append("g")
      .attr("transform", `translate(0,${seriesHeight})`)
      .call(d3.axisBottom(seriesX));
    seriesG.append("g")
      .call(d3.axisLeft(seriesY));
  </script>
</body>
</html>